{
  "id" : "be221837-873b-49d0-b32f-e278c2105ca5",
  "name" : "Workday - Create Invoice",
  "enabled" : true,
  "tasks" : [ {
    "id" : "aac7c774-9e76-400b-838b-6e0a21d166a5",
    "ordinal" : 1,
    "taskParameters" : [ {
      "id" : "c788b619-c68a-42c9-bce7-8ddb4bababf6",
      "ordinal" : 1,
      "value" : "http://api4dev.shopvisible.com/OrderService.asmx/GetOrdersByDateRange?ClientName=TheMet_Staging&Guid=cd792d11-bf8c-e611-8101-06a33a6db6fd&DateStart=3%2F22%2F2017&DateEnd=3%2F22%2F2017&IncludeCustomerInfo=TRUE",
      "desc" : "URL to post.  Delimited parameters will be replaced",
      "name" : "url",
      "valueType" : 0,
      "secret" : false,
      "refId" : "9ba450d6-f280-4de2-b43a-941d6bb31495"
    }, {
      "id" : "dbbdfdca-06aa-475f-900a-75ccefc08cd0",
      "ordinal" : 3,
      "value" : "",
      "desc" : "Success Processor",
      "name" : "successProcessor",
      "valueType" : 2,
      "secret" : false,
      "refId" : "09821f9a-59c0-4e92-872a-842411f83276"
    }, {
      "id" : "b5c9aac9-4a2b-4fa9-bd36-c0bf0329d45f",
      "ordinal" : 4,
      "value" : "",
      "desc" : "Authentication Processor",
      "name" : "authProcessor",
      "valueType" : 2,
      "secret" : false,
      "refId" : "6d7a9a8c-d849-4946-80ad-fcf8f1992d86"
    }, {
      "id" : "3b80291c-abde-422f-9aec-1743c8d3779d",
      "ordinal" : 5,
      "value" : "OrderInfo",
      "desc" : "Key name of output",
      "name" : "outputKey",
      "valueType" : 0,
      "secret" : false,
      "refId" : "14f3479a-a907-4f1a-a218-a58d995c5de2"
    }, {
      "id" : "5baeb429-8fbf-4c01-9271-e9810549247e",
      "ordinal" : 7,
      "value" : "Mozilla/5.0",
      "desc" : "User Agent Header",
      "name" : "userAgent",
      "valueType" : 0,
      "secret" : false,
      "refId" : "b651d20b-83f4-4ba8-a7a8-6bf6481caaf0"
    } ],
    "job" : {
      "id" : "be221837-873b-49d0-b32f-e278c2105ca5",
      "name" : "Workday - Create Invoice",
      "enabled" : true,
      "desc" : "Workday - Create Invoice",
      "status" : "READY",
      "snsARN" : "arn:aws:sns:us-east-1:194810246581:Ignition_Job_1bbd1738-25d6-4ded-bf97-0593d5ac7595",
      "key" : "IC-00000004",
      "environment" : "STAGING"
    },
    "name" : "Http Get to Map Task",
    "key" : "Core::HttpGetToMapTask",
    "comment" : "Used for debug",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.HttpGetToMapTask",
    "enabled" : false,
    "desc" : "Task used to do an http get and store it's information to the map",
    "refId" : "6da8b3d0-7d76-43e0-a047-fabdc31063eb",
    "clazzType" : "Java",
    "childTasks" : [ ],
    "hasSubTask" : false,
    "stopOnError" : true,
    "reportOnError" : true
  }, {
    "id" : "9c31986f-efe4-4f37-bbe6-34a58a6dac4e",
    "ordinal" : 2,
    "taskParameters" : [ {
      "id" : "994daeee-93c1-4c17-9bc4-ea81302afd57",
      "ordinal" : 1,
      "value" : "!{ftpuser}",
      "desc" : "User to login to ftp",
      "name" : "user",
      "valueType" : 0,
      "secret" : false,
      "refId" : "4f75fa01-c582-49aa-8f20-1b48462a8b28"
    }, {
      "id" : "e6362117-43e7-42f6-b09e-b52b739eb612",
      "ordinal" : 2,
      "value" : "Mu+KttQ5jSnVA9I9kN9ebw==",
      "desc" : "Password to login to ftp",
      "name" : "password",
      "valueType" : 0,
      "secret" : true,
      "refId" : "48fbf631-e014-45ee-a8eb-298ac7d1fa21"
    }, {
      "id" : "5f51385e-7f1e-4b45-8119-032871a47d12",
      "ordinal" : 3,
      "value" : "!{ftpurl}/input/EpsilonOrderCreated.*.xml",
      "desc" : "Url to file",
      "name" : "url",
      "valueType" : 0,
      "secret" : false,
      "refId" : "45c250b3-72b5-4d81-a392-6ab7c6f5709d"
    }, {
      "id" : "9132022c-8d01-4684-8647-3d86483e62ae",
      "ordinal" : 4,
      "value" : "OrderInfo",
      "desc" : "Key name of output file",
      "name" : "outputKey",
      "valueType" : 0,
      "secret" : false,
      "refId" : "201b77ea-8e35-4c3c-9f45-dd8afc123e10"
    } ],
    "job" : {
      "id" : "be221837-873b-49d0-b32f-e278c2105ca5",
      "name" : "Workday - Create Invoice",
      "enabled" : true,
      "desc" : "Workday - Create Invoice",
      "status" : "READY",
      "snsARN" : "arn:aws:sns:us-east-1:194810246581:Ignition_Job_1bbd1738-25d6-4ded-bf97-0593d5ac7595",
      "key" : "IC-00000004",
      "environment" : "STAGING"
    },
    "name" : "Download File to Map Task",
    "key" : "Core::DownloadFileToMapTask",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.DownloadFileToMapTask",
    "enabled" : true,
    "desc" : "Task used to download a file from FTP,SFTP,FTPS,Local and S3.",
    "refId" : "84211b05-40ce-4939-874d-825b983c3bda",
    "clazzType" : "Java",
    "childTasks" : [ ],
    "hasSubTask" : false,
    "stopOnError" : true,
    "reportOnError" : true
  }, {
    "id" : "6b092801-cc79-4d51-984d-139d729686f2",
    "ordinal" : 3,
    "taskParameters" : [ {
      "id" : "d6ce48a0-f16b-49b8-885f-ceb6210f4bd9",
      "ordinal" : 1,
      "value" : "OrderInfo",
      "desc" : "Key name of input file\n",
      "name" : "inputKey",
      "valueType" : 0,
      "secret" : false,
      "refId" : "33b71961-09fb-4f69-9df8-46721a14b8a4"
    }, {
      "id" : "a10fda04-8359-450a-9874-7fbd4b8471a0",
      "ordinal" : 2,
      "value" : "OrdersMap",
      "desc" : "Key name to hold return value in dictionary",
      "name" : "outputKey",
      "valueType" : 0,
      "secret" : false,
      "refId" : "f1628808-0116-4d32-bff0-af0cb53d06b2"
    }, {
      "id" : "d88c95f6-4fbb-41b4-8250-cfb62e11fc2b",
      "ordinal" : 4,
      "value" : "/Orders/Order",
      "desc" : "Node to Break the row on",
      "name" : "rowIndicator",
      "valueType" : 0,
      "secret" : false,
      "refId" : "be88cc2e-5ba9-4277-a484-1d8146b78565"
    } ],
    "job" : {
      "id" : "be221837-873b-49d0-b32f-e278c2105ca5",
      "name" : "Workday - Create Invoice",
      "enabled" : true,
      "desc" : "Workday - Create Invoice",
      "status" : "READY",
      "snsARN" : "arn:aws:sns:us-east-1:194810246581:Ignition_Job_1bbd1738-25d6-4ded-bf97-0593d5ac7595",
      "key" : "IC-00000004",
      "environment" : "STAGING"
    },
    "name" : "XML to Map Task",
    "key" : "Core::XmlToMapTask",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.XmlToMapTask",
    "enabled" : true,
    "desc" : "Task used to read xml file into the dictionary",
    "refId" : "4ca3d6e5-23fc-4d6a-beb2-09f0c9a5c2f3",
    "clazzType" : "Java",
    "childTasks" : [ ],
    "hasSubTask" : false,
    "stopOnError" : true,
    "reportOnError" : true
  }, {
    "id" : "c861016d-e070-4d7c-9196-4a1ebefa63f4",
    "ordinal" : 4,
    "taskParameters" : [ {
      "id" : "5c4fb811-21d2-438f-8c12-b1ffa19b187a",
      "ordinal" : 1,
      "value" : "/*\n * Takes an Orders hash generated from APTOS Order xml, executes\n * business rule against it  \n */\nload('!{ThisHost}/js/global.js')\nvar root = new java.util.HashMap();\nvar mifIterator = new com.ignitioncommerce.transform.util.MapInFileIterator(dict.get('OrdersMap'));\n\nvar invoices = new java.util.ArrayList();\nvar seq = 1;\nvar isReturn = false;\nvar fileName = dict.get('OrderInfo_ORIG_FILE_NAME_');\nvar pos = fileName.indexOf('_');\nvar pos2 = fileName.indexOf('_', pos+1);\nvar shipDate = fileName.substring(pos+1, pos2);\n//var orderCredits = getOrderCredits(shipDate);\nvar creditReasonMap = { \"Customer Appeasement\": \"CA\", \"Postage Refund\": \"C \", \"Gift Wrap Refund\": \"GW\",\n                        \"Promo Discount Refund\": \"P\", \"Freight Credit\": \"F \", \"Member Discount\": \"MD\",\n                        \"Return Credit\": \"R \", \"Miscellaneous\": \"D \", \"Other\": \"D \"};\nwhile (mifIterator.hasNext()) {\n  var order = mifIterator.next();\n  var orderStatus = order.OrderStatusId;\n  var orderXML = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><env:Envelope xmlns:env=\\\"http://schemas.xmlsoap.org/soap/envelope/\\\"\txmlns:xsd=\\\"http://www.w3.org/2001/XMLSchema\\\" xmlns:bsvc=\\\"urn:com.workday/bsvc\\\" xmlns:wsse=\\\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\\\">\";\norderXML += \"<env:Header><wsse:Security env:mustUnderstand=\\\"1\\\">\";\norderXML += \"<wsse:UsernameToken>\";\norderXML += \"<wsse:Username>!{WorkDayUsername}</wsse:Username>\";\norderXML += \"<wsse:Password Type=\\\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\\\">!{WorkDayPassword}</wsse:Password>\";\norderXML += \"</wsse:UsernameToken>\";\norderXML += \"</wsse:Security>\";\norderXML += \"<bsvc:Workday_Common_Header>\";\norderXML += \"<bsvc:Include_Reference_Descriptors_In_Response>true</bsvc:Include_Reference_Descriptors_In_Response>\";\norderXML += \"</bsvc:Workday_Common_Header>\";\norderXML += \"</env:Header>\";\norderXML += \"<env:Body>\";\norderXML += \"<bsvc:Submit_Customer_Invoice_Request bsvc:Add_Only=\\\"true\\\" bsvc:version=\\\"v28.0\\\" xmlns:bsvc=\\\"urn:com.workday/bsvc\\\">\";\norderXML += \"<bsvc:Business_Process_Parameters>\";\norderXML += \"<bsvc:Auto_Complete>true</bsvc:Auto_Complete>\";\norderXML += \"<bsvc:Comment_Data>\";\norderXML += \"<bsvc:Comment>Submitted by Aptos</bsvc:Comment>\";\norderXML += \"</bsvc:Comment_Data>\";\norderXML += \"</bsvc:Business_Process_Parameters>\";\norderXML += \"<bsvc:Customer_Invoice_Data>\";\n//orderXML += \"<bsvc:Customer_Order_Number>10185</bsvc:Customer_Order_Number>\";\norderXML += \"<bsvc:Customer_PO_Number></bsvc:Customer_PO_Number>\";\norderXML += \"<bsvc:Company_Reference>\";\norderXML += \"<bsvc:ID bsvc:type=\\\"Company_Reference_ID\\\">100</bsvc:ID>\";\norderXML += \"</bsvc:Company_Reference>\";\norderXML += \"<bsvc:Customer_Reference>\";\norderXML += \"<bsvc:ID bsvc:type=\\\"Customer_ID\\\">\" + order.OrderCustomer.CustomerExternalID + \"</bsvc:ID>\";\norderXML += \"</bsvc:Customer_Reference>\";\n//orderXML += \"<bsvc:Invoice_Date>2017-03-22T15:29:00</bsvc:Invoice_Date>\";\norderXML += \"<bsvc:Amount_Due>\" + order.OrderAmountBalance + \"</bsvc:Amount_Due>\";\n//orderXML += \"<bsvc:Memo></bsvc:Memo>\";\norderXML += \"<bsvc:Customer_Invoice_Line_Replacement_Data>\";\norderXML += \"<bsvc:Line_Item_Description>Shipping</bsvc:Line_Item_Description>\";\norderXML += \"<bsvc:Quantity>1</bsvc:Quantity>\";\norderXML += \"<bsvc:Unit_Cost>\" + order.OrderAmountShipping + \"</bsvc:Unit_Cost>\";\norderXML += \"<bsvc:Line_Order>1</bsvc:Line_Order>\";\norderXML += \"<bsvc:Revenue_Category_Reference>\";\norderXML += \"<bsvc:ID bsvc:type=\\\"Shipping\\\"></bsvc:ID>\";\norderXML += \"</bsvc:Revenue_Category_Reference>\";\norderXML += \"</bsvc:Customer_Invoice_Line_Replacement_Data>\";\n\nvar itemList = ICT.LIST(order.OrderItems.Item);\nif (itemList.size() == 0) continue;\nvar oiIter = itemList.iterator();\nvar iCtr = 2;\nwhile(oiIter.hasNext()) {\n  var orderItem = oiIter.next();\n  var shipDateFound = false;\n  var itemShipDate = orderItem.ItemShipDate;\n  \n  try {\n\tvar parts = itemShipDate.split('T');\n\titemShipDate = parts[0];\n\titemShipDate = itemShipDate.replaceAll('\\\\-', '');\n\tshipDateFound = true;\n  } catch (err) { }\n  \n  if (itemStatus == '17' && shipDateFound && itemShipDate.equalsIgnoreCase(shipDate)) {\n\taddItem(order, 'I', '01', orderItem.ItemProduct.ProductPartNo, orderItem.ItemQuantity,\n\t  ICT.CUR(orderItem.ItemPrice), ICT.CUR(orderItem.ItemTax), false, itemStatus, '');\n  } else if (itemStatus == '24' && shipDateFound && itemShipDate.equalsIgnoreCase(shipDate)) {\n  } else if (itemStatus == '6' && shipDateFound && itemShipDate.equalsIgnoreCase(shipDate)) {\n  }\n\n  orderXML += \"<bsvc:Customer_Invoice_Line_Replacement_Data>\";\n  orderXML += \"<bsvc:Line_Item_Description>\" + orderItem.ItemProduct.ProductPartNo + \" \" + orderItem.ItemProduct.ProductCode + \"</bsvc:Line_Item_Description>\";\n  orderXML += \"<bsvc:Quantity>\" + orderItem.ItemProduct.ItemQuantity + \"</bsvc:Quantity>\";\n  orderXML += \"<bsvc:Unit_Cost>\" + orderItem.ItemProduct.Price.PriceSale + \"</bsvc:Unit_Cost>\";\n  orderXML += \"<bsvc:Line_Order>\" + iCtr + \"</bsvc:Line_Order>\";\n  orderXML += \"<bsvc:Revenue_Category_Reference>\";\n  orderXML += \"<bsvc:ID bsvc:type=\\\"Revenue_Category_ID\\\"></bsvc:ID>\";\n  orderXML += \"</bsvc:Revenue_Category_Reference>\";\n  orderXML += \"</bsvc:Customer_Invoice_Line_Replacement_Data>\";\n  \n  iCtr++;\n}\n\norderXML += \"</bsvc:Customer_Invoice_Data>\";\norderXML += \"</bsvc:Submit_Customer_Invoice_Request>\";\norderXML += \"</env:Body>\";\norderXML += \"</env:Envelope>\";\n\n    \n    invoices.add(orderXML);\n    dict.put(\"invoices\",invoices);\n}",
      "desc" : "Script to execute",
      "name" : "script",
      "valueType" : 2,
      "secret" : false,
      "refId" : "61734d1c-1ff6-4a2b-a251-00f3bd76b9ed"
    } ],
    "job" : {
      "id" : "be221837-873b-49d0-b32f-e278c2105ca5",
      "name" : "Workday - Create Invoice",
      "enabled" : true,
      "desc" : "Workday - Create Invoice",
      "status" : "READY",
      "snsARN" : "arn:aws:sns:us-east-1:194810246581:Ignition_Job_1bbd1738-25d6-4ded-bf97-0593d5ac7595",
      "key" : "IC-00000004",
      "environment" : "STAGING"
    },
    "name" : "Script Task",
    "key" : "Core::ScriptTask",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.ScriptTask",
    "enabled" : true,
    "desc" : "Task used to execute custom javascript",
    "refId" : "f5d44f40-cbd4-45fa-b45f-b062e546ad0f",
    "clazzType" : "Java",
    "childTasks" : [ ],
    "hasSubTask" : false,
    "stopOnError" : true,
    "reportOnError" : true
  }, {
    "id" : "bff72b73-f4a2-4dbc-bc3d-b2504b9974e8",
    "ordinal" : 5,
    "taskParameters" : [ {
      "id" : "e540d9fd-1b80-45be-a9c1-e67a089e049e",
      "ordinal" : 1,
      "value" : "Root",
      "desc" : "Key name of input ",
      "name" : "inputKey",
      "valueType" : 0,
      "secret" : false,
      "refId" : "e2963db8-9c7d-4863-b1ec-7a1bf15dbd52"
    }, {
      "id" : "94d4cef8-215c-4452-9522-6b1701b273ac",
      "ordinal" : 2,
      "value" : "<xml version=\"1.0\"><test>${test}</test>",
      "desc" : "Template to use",
      "name" : "template",
      "valueType" : 2,
      "secret" : false,
      "refId" : "ed2bc33b-2474-4c9f-a7bb-80183abe53cf"
    }, {
      "id" : "dc2ea05a-36e9-4736-9436-98a4330bc9c9",
      "ordinal" : 3,
      "value" : "Invoices",
      "desc" : "Key name of output ",
      "name" : "outputKey",
      "valueType" : 0,
      "secret" : false,
      "refId" : "be1f40ef-6389-4aa3-9124-4231b715107a"
    } ],
    "job" : {
      "id" : "be221837-873b-49d0-b32f-e278c2105ca5",
      "name" : "Workday - Create Invoice",
      "enabled" : true,
      "desc" : "Workday - Create Invoice",
      "status" : "READY",
      "snsARN" : "arn:aws:sns:us-east-1:194810246581:Ignition_Job_1bbd1738-25d6-4ded-bf97-0593d5ac7595",
      "key" : "IC-00000004",
      "environment" : "STAGING"
    },
    "name" : "Freemarker Execute Task",
    "key" : "Core::FreemarkerExecuteTask",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.FreemarkerExecuteTask",
    "enabled" : false,
    "desc" : "Task used to execute Freemarker template.",
    "refId" : "edb872f0-243b-46ea-9149-ca967fe766e7",
    "clazzType" : "Java",
    "childTasks" : [ ],
    "hasSubTask" : false,
    "stopOnError" : true,
    "reportOnError" : true
  }, {
    "id" : "90d400fa-a2ef-4d1d-86ed-9ade0b304c2e",
    "ordinal" : 6,
    "taskParameters" : [ {
      "id" : "937afc31-7598-426b-8259-c439f5c60c7c",
      "ordinal" : 1,
      "value" : "submitCustomerInvoiceXML",
      "desc" : "Left Hand Parameter (left of equal)",
      "name" : "leftParam",
      "valueType" : 0,
      "secret" : false,
      "refId" : "872220ae-b87f-4ee4-8f74-b818960e521f"
    }, {
      "id" : "707ace7d-d9f9-468f-b77e-6823ba501e1b",
      "ordinal" : 2,
      "value" : "<#compress>\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<bsvc:Submit_Customer_Invoice_Request bsvc:Add_Only=\"false\" bsvc:version=\"string\" xmlns:bsvc=\"urn:com.workday/bsvc\">\n\t<bsvc:Customer_Invoice_Reference bsvc:Descriptor=\"string\">\n    <!--Zero or more repetitions:-->\n    <@inc map \"\"><bsvc:ID bsvc:type=\"string\">string</bsvc:ID></@inc>\n  </bsvc:Customer_Invoice_Reference>\n\t<bsvc:Customer_Invoice_Data>\n\t\t<@inc map \"OrderAuthDate\"><bsvc:Invoice_Date>${map.OrderAuthDate}</bsvc:Invoice_Date></@inc>\n\t</bsvc:Customer_Invoice_Data>\n</bsvc:Submit_Customer_Invoice_Request>",
      "desc" : "Right Hand Parameter (right of equal)  Can contain ${} that contains javascript",
      "name" : "rightParam",
      "valueType" : 2,
      "secret" : false,
      "refId" : "983f881a-9f10-43cc-9850-e913d2ad530a"
    } ],
    "job" : {
      "id" : "be221837-873b-49d0-b32f-e278c2105ca5",
      "name" : "Workday - Create Invoice",
      "enabled" : true,
      "desc" : "Workday - Create Invoice",
      "status" : "READY",
      "snsARN" : "arn:aws:sns:us-east-1:194810246581:Ignition_Job_1bbd1738-25d6-4ded-bf97-0593d5ac7595",
      "key" : "IC-00000004",
      "environment" : "STAGING"
    },
    "name" : "Assign Task",
    "key" : "Core::AssignTask",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.AssignTask",
    "enabled" : true,
    "desc" : "Task used to Assign one key to another in the parameter dictionary",
    "refId" : "f749f807-bc45-4213-8db8-e66a8f263f44",
    "clazzType" : "Java",
    "childTasks" : [ ],
    "hasSubTask" : false,
    "stopOnError" : true,
    "reportOnError" : true
  } ],
  "desc" : "Workday - Create Invoice",
  "status" : "READY",
  "snsARN" : "arn:aws:sns:us-east-1:194810246581:Ignition_Job_1bbd1738-25d6-4ded-bf97-0593d5ac7595",
  "key" : "IC-00000004",
  "environment" : "STAGING"
}